// dreamland.js, MIT license
const DLFEATURES = ['css', 'jsxLiterals', 'usestring', 'stores']; const DLVERSION = '0.0.23-pre';
!function(e){const[t,n,r,s,o,l,i]=Array.from(Array(7),Symbol),c="dlcomponent",f={};let a;const u=50;function d(){return`${Array(4).fill(0).map((()=>Math.floor(36*Math.random()).toString(36))).join("")}`}const p=e=>function(t,...n){let r="";for(let e of t)r+=e+(n.shift()||"");return b("dl"+d(),r,e)},m=p(!1),h=p(!0);function b(e,t,n){let r=f[t];if(r)return r;f[t]=e;const s=document.createElement("style");document.head.appendChild(s);let o="",l="";for(t+="\n";;){let[e,...n]=t.split("\n");if(e.trim().endsWith("{"))break;if(l+=e+"\n",!(t=n.join("\n")))break}if(s.textContent=t,n){if(!function(){if(a)return!0;const e=document.createElement("style");e.textContent="@scope (.test) { :scope { color: red } }",document.head.appendChild(e);const t=document.createElement("div");t.className="test",document.body.appendChild(t);const n=getComputedStyle(t).color;return document.head.removeChild(e),document.body.removeChild(t),a="rgb(255, 0, 0)"==n,a}()){let t=function(e){let t=`:not(${e}).${c}`,n=(r,s)=>`${r} *${s>u?"":`:not(${n(r+" "+(s%2==0?e:t),s+1)})`}`;return`:not(${n(t,0)})`}(`.${e}`);for(const n of s.sheet.cssRules)n.selectorText?.startsWith(":")?n.selectorText=`.${e}${n.selectorText}`:n.selectorText=`.${e} ${n.selectorText}${t}`,o+=n.cssText+"\n";return s.textContent=`.${e} {${l}}\n`+o,e}let t="";for(const n of s.sheet.cssRules)n.selectorText||n.media?n.selectorText?.startsWith(":")?(n.selectorText=`.${e}${n.selectorText}`,t+=n.cssText):o+=n.cssText:t+=n.cssText;s.textContent=`.${e} {${l}} @scope (.${e}) to (:not(.${e}).${c} *) { ${o} } ${t}`}else{const t=t=>{t.selectorText&&(t.selectorText=t.selectorText.split(",").map((t=>":"===(t=t.trim())[0]?`.${e}${t}`:`.${e} ${t}`)).join(", ")),o+=t.cssText};for(const e of s.sheet.cssRules)e.media&&e.media.mediaText?(o+=`@media(${e.media.mediaText}){`,Array.from(e.cssRules).map(t),o+="}"):t(e);s.textContent=`.${e} {${l}}${o}`}return e}let g=document;const y=Symbol();let $=!1;Object.defineProperty(window,"use",{get:()=>($=!0,(e,o,...l)=>{if(e instanceof Array)return x(e,o,...l);j(e)||L(e),$=!1;let i={get value(){return function(e){let o=e[r],l=o[s],i=e[t],c=o[n];for(let e of l)if(c=c[e],!S(c))break;for(let e of i)c=e(c);return c}(i)}};if(L(e)){let n=[...e[t]];o&&n.push(o),i[r]=e[r],i[t]=n}else i[r]=e,i[t]=o?[o]:[];return i})}),Object.defineProperty(window,"useChange",{get:()=>($=!0,(e,t)=>{$=!1,e=e instanceof Array?e:[e];for(let n of e)j(n)||L(n),k(use(n),t)})});const x=(e,...t)=>{$=!1;let n=T({});const r=[];for(const s in e)if(r.push(e[s]),t[s]){let e=t[s];if(j(e)&&(e=use(e)),L(e)){const t=r.length;let s;k(use(e),(e=>{r[t]=String(e);let o=r.join("");o!=s&&(n.string=o),s=o}))}else r.push(String(e))}return n.string=r.join(""),use(n.string)};let v=new Map;function T(e){S(e),e[o]=[],e[n]=e;let l=Symbol.toPrimitive,c=new Proxy(e,{get(e,o,i){if($){let c=Symbol(),f=new Proxy({[n]:e,[r]:i,[s]:[o],[l]:()=>c},{get:(e,o)=>[n,r,s,t,l].includes(o)?e[o]:(o=v.get(o)||o,e[s].push(o),f)});return v.set(c,f),f}return Reflect.get(e,o,i)},set(e,t,n){let r=Reflect.set(e,t,n);for(let r of e[o])r(e,t,n);return e[i]&&e[i](e,t,e[t]),r}});return c}let S=e=>e instanceof Object;function w(e){return S(e)&&o in e}function j(e){return S(e)&&s in e}function L(e){return S(e)&&t in e}function k(e,l){L(e);let i,c=e[r],f=e[t],a=[];function u(){let e=c[n];for(i of a)if(e=e[i],!S(e))break;for(let t of f)e=t(e);l(e)}let d=(e,t)=>function r(s,l,i){if(l===a[t]&&e===s&&(u(),S(i))){let e=i[o];e&&!e.includes(r)&&e.push(d(i[n],t+1))}};for(let e in c[s]){let t=c[s][e];S(t)&&t[n]?k(t,(t=>{a[e]=t,u()})):a[e]=t}let p=d(c[n],0);c[n][o].push(p),p(c[n],a[0],c[n][a[0]])}function A(e,t,n){let r,s,o,l;k(e,(e=>{o=s?.[0],o&&(r=o.previousSibling||(l=o.parentNode)),s&&s.forEach((e=>e.remove())),s=N(n?e?n.then:n.otherwise:e,(e=>{r?(l?(r.prepend(e),l=null):r.after(e),r=e):t(e)}))}))}let O=e=>t=>{let n=e[r],o=e[s],l=0;for(;l<o.length-1;l++)if(n=n[o[l]],!S(n))return;n[o[l]]=t};function C(e,t,...n){if(e==y)return n;if("function"==typeof e){let s=T(Object.create(e.prototype));for(let e in t){let n=t[e];if(e.startsWith("bind:")){L(n);let o=O(n[r]),l=e.substring(5);if("this"==l)o(s);else{let e=!1;k(n,(t=>{e?e=!1:(e=!0,s[l]=t)})),k(use(s[l]),(t=>{e?e=!1:(e=!0,o(t))}))}delete t[e]}}Object.assign(s,t),s.children=[];for(let e of n)N(e,s.children.push.bind(s.children));let o=e.apply(s);o.$=s,s.root=o;let l=o.classList,i=s.css,f=e.name.replaceAll("$","-");return i&&l.add(b(`${f}-${d()}`,i,!0)),s._leak||l.add(c),o.setAttribute("data-component",e.name),"function"==typeof s.mount&&s.mount(),o}let s=t?.xmlns,o=s?g.createElementNS(s,e):g.createElement(e);for(let e of n){N(e,o.append.bind(o))}if(!t)return o;((e,n)=>{if(!(e in t))return;n(t[e]),delete t[e]})("class",(e=>{if("string"==typeof e||e instanceof Array||L(e),"string"!=typeof e)if(L(e)){let t="";k(e,(e=>{for(let e of t.split(" "))e&&o.classList.remove(e);if("string"==typeof e){for(let t of e.split(" "))t&&o.classList.add(t);t=e}}))}else for(let t of e)if(L(t)){let e=null;k(t,(t=>{"string"==typeof e&&o.classList.remove(e),o.classList.add(t),e=t}))}else o.classList.add(t);else o.setAttribute("class",e)}));for(let e in t){let n=t[e];if(e.startsWith("bind:")){L(n);let s=e.substring(5),l=O(n[r]);"this"==s?l(o):"value"==s?(k(n,(e=>o.value=e)),o.addEventListener("change",(()=>l(o.value)))):"checked"==s&&(k(n,(e=>o.checked=e)),o.addEventListener("click",(()=>l(o.checked)))),delete t[e]}if(e.startsWith("class:")){let r=e.substring(6);L(n)?k(n,(e=>{e?o.classList.add(r):o.classList.remove(r)})):n&&o.classList.add(r),delete t[e]}if("style"==e&&S(n)&&!L(n)){for(let e in n){let t=n[e];L(t)?k(t,(t=>o.style[e]=t)):o.style[e]=t}delete t[e]}}for(let e in t){let n=t[e];L(n)?k(n,(t=>{E(o,e,t)})):E(o,e,n)}return s&&(o.innerHTML=o.innerHTML),o}function N(e,t){let n,r,s;if(L(e))A(e,t);else{if(!S(e)||!(l in e)){if(e instanceof Node)return t(e),[e];if(e instanceof Array){for(n of(r=[],e))r=r.concat(N(n,t));return r[0]||(r=N("",t)),r}return null==e&&(e=""),s=g.createTextNode(e),t(s),[s]}A(e[l],t,e)}}function E(e,t,n){if(!n&&e.hasAttribute(t)&&e.removeAttribute(t),n)if(t.startsWith("on:")){let r=t.substring(3);for(let t of r.split("$"))e.addEventListener(t,((...t)=>{self.$el=e,n(...t)}))}else e.setAttribute(t,n)}e.$if=function(e,t,n){return n??=g.createTextNode(""),L(e)?{[l]:e,then:t,otherwise:n}:e?t:n},e.$state=T,e.$store=function(e,{ident:t,backing:r,autosave:s}){let o,l;if("string"==typeof r){if("localstorage"===r)o=()=>localStorage.getItem(t),l=(e,t)=>{localStorage.setItem(e,t)}}else({read:o,write:l}=r);let c=()=>{console.info("[dreamland.js]: saving "+t);let n={},r=0,s=e=>{let t={stateful:w(e),values:{}},o=r++;n[o]=t;for(let n in e){let r=e[n];if(!L(r))switch(typeof r){case"string":case"number":case"boolean":case"undefined":t.values[n]=JSON.stringify(r);break;case"object":if(r instanceof Array){t.values[n]=r.map((e=>"object"==typeof e?s(e):JSON.stringify(e)));break}null===r?t.values[n]="null":(r.__proto__,Object.prototype,t.values[n]=s(r))}}return o};s(e);let o=JSON.stringify(n);l(t,o)},f=(e,t,r)=>{w(r)&&(r[n][i]=f),c()},a=JSON.parse(o(t));if(a){let t={},n=e=>{if(t[e])return t[e];let r=a[e],o={};for(let e in r.values){let t=r.values[e];o[e]="string"==typeof t?JSON.parse(t):t instanceof Array?t.map((e=>"string"==typeof e?JSON.parse(e):n(e))):n(t)}r.stateful&&"auto"==s&&(o[i]=f);let l=r.stateful?T(o):o;return t[e]=l,l};e=n(0)}switch(s){case"beforeunload":addEventListener("beforeunload",c);break;case"manual":break;case"auto":e[i]=f}return T(e)},e.Fragment=y,e.css=m,e.h=C,e.html=function(e,...t){e=[...e];let n="",r={};for(let s=0;s<e.length;s++){let o=e[s],l=t[s],i=t[s]instanceof Function&&/^ *\/>/.exec(e[s+1]);if(/< *$/.test(o)&&i&&(e[s+1]=e[s+1].substr(i.index+i[0].length)),n+=o,s<t.length){let e,t=Object.values(r).findIndex((e=>e===l));-1!==t?e=Object.keys(r)[t]:(e="h"+d(),r[e]=l),n+=e,i&&(n+=`></${e}>`)}}let s=(new DOMParser).parseFromString(n,"text/html");return s.body.children.length,function e(t){let n=t.nodeName.toLowerCase();if("#text"===n)return t.textContent;n in r&&(n=r[n]);let s=[...t.childNodes].map(e);for(let e=0;e<s.length;e++){let t=s[e];if("string"==typeof t)for(const[n,o]of Object.entries(r)){if(!t)break;if(!t.includes(n))continue;let r;[r,t]=t.split(n),s=[...s.slice(0,e),r,o,t,...s.slice(e+1)],e+=2}}let o={};if(!t.attributes)return t;for(const e of[...t.attributes]){let t=e.nodeValue;t in r&&(t=r[t]),o[e.name]=t}return C(n,o,s)}(s.body.children[0])},e.isDLPtr=L,e.isStateful=w,e.scope=h}(window)
//# sourceMappingURL=all.js.map
